<div class="container d-flex justify-content-center p-3 cardHero text-light">
   <h4>{{groupData.groupName}}</h4>
</div>
<hr>

<div id="localToolGroup">
  <div class="dropdown">
    <div class="iconMembers" type="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="material-symbols-outlined p-3 text-light members">
      groups
    </span>
  </div>
    <ul class="dropdown-menu">
      <li>
        <a class="dropdown-item" href="#">Action</a>
      </li>
      <li>
        <a class="dropdown-item" href="#">Another action</a>
      </li>
      <li>
        <a class="dropdown-item" href="#">Something else here</a>
      </li>
    </ul>
  </div>
  
  <div class="iconMembers">
    <span class="material-symbols-outlined p-3 text-light members">
    person_add
    </span>
  </div>
</div>

<div class="localChat">
    <div class="container contentMsg">
        <div class="contentChat">
            <div id="messages"></div>
        </div>

        <form class="p-3" id="messageForm">
            <input class="form-control" type="text" id="messageInput" placeholder="Digite sua mensagem..." required>
            <button class="btnSend" type="submit">
              <span class="material-symbols-outlined">
                send
              </span>
            </button>
        </form>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const groupId = "{{group._id}}"; 
  const userId = "{{user._id}}"; 

  document.getElementById('messageForm').addEventListener('submit', (event) => {
    event.preventDefault();
    const message = document.getElementById('messageInput').value;

    // Emitindo a mensagem com o nome do usuário
    socket.emit('sendMessage', { groupId, message, userId, username: "{{user.username}}" });
    document.getElementById('messageInput').value = '';
  });

  socket.on('receiveMessage', (data) => {
    const msgDiv = document.createElement('div')
    msgDiv.classList.add('msgStyle')

    // Criação da estrutura para mostrar a mensagem com o nome do usuário
    const userName = document.createElement('strong')
    userName.textContent = data.username;  // Exibindo o nome do usuário
    msgDiv.appendChild(userName)

    // Exibindo a mensagem
    const messageText = document.createElement('span')
    messageText.textContent = `: ${data.message}`
    msgDiv.appendChild(messageText);

    const loggedUserId = "{{user._id}}".toString() 

    if (data.userId === loggedUserId) {
        msgDiv.classList.add("me") 
        document.getElementById('messages').classList.add('meBloque')
    } else {
        msgDiv.classList.add("other")
        document.getElementById('messages').classList.add('otherBloque')
    }

    document.getElementById('messages').appendChild(msgDiv)
  })
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

