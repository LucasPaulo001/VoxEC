<div class="container d-flex justify-content-center p-3 cardHero text-light">
   <h4>{{groupData.groupName}}</h4>
</div>
<hr>

<div id="localToolGroup">
  <div class="btnToolData">
    <div class="dropdown">
      <div class="iconMembers" type="button" data-bs-toggle="dropdown" aria-expanded="false">
      <button class="btnTool">
        <span class="material-symbols-outlined p-3 text-light members">
          groups
        </span>
      </button>
    </div>
      <ul class="dropdown-menu">
        <div class="d-flex justify-content-center">
          <h4>Membros</h4>
        </div>
        <hr>
        {{#each groupData.members}}
          <li class="list-group-item listMember p-3">
            <strong>{{this.username}}</strong>
            <span data-user-id="{{this._id}}">
              {{#if this.isOnline}} ðŸŸ¢ {{else}} ðŸ”´ {{/if}}
            </span>
          </li>
        {{else}}
          <div class="d-flex mt-4 justify-content-center">
            <h5>Nenhum participante neste grupo</h5>
          </div>
        {{/each}}
      </ul>
    </div>
    <div class="iconMembers" type="button">
      <button class="btnTool" onclick="openFormAdd()">
        <span class="material-symbols-outlined p-3 text-light members">
          person_add
        </span>
      </button>
    </div>
  </div>
  <div class="inputAdd inputContent" id="form">
    <span class="material-symbols-outlined iconFormAdd">
      identity_platform
    </span>
    <input type="text" placeholder="Busque por username" class="form-control">
    <div class="btns">
      <button class="btnAction">Add</button>
    </div>
  </div>
</div>

<div class="localChat">
    <div class="container contentMsg">
        <div class="contentChat">
            <div id="messages"></div>
        </div>

        <form class="p-3" id="messageForm">
            <input class="form-control" type="text" id="messageInput" placeholder="Digite sua mensagem..." required>
            <button class="btnSend" type="submit">
              <span class="material-symbols-outlined">
                send
              </span>
            </button>
        </form>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io({ query: { userId: "{{user._id}}" } })

  const groupId = "{{group._id}}" 
  const userId = "{{user._id}}" 

  document.getElementById('messageForm').addEventListener('submit', (event) => {
    event.preventDefault()
    const message = document.getElementById('messageInput').value
    socket.emit('sendMessage', { groupId, message, userId, username: "{{user.username}}" })
    document.getElementById('messageInput').value = ''
  })

  socket.on('receiveMessage', (data) => {
    const msgDiv = document.createElement('div')
    msgDiv.classList.add('msgStyle')

    const userName = document.createElement('strong')
    userName.textContent = data.username
    msgDiv.appendChild(userName)

    const messageText = document.createElement('span')
    messageText.textContent = `: ${data.message}`
    msgDiv.appendChild(messageText)

    const loggedUserId = "{{user._id}}".toString()
    if (data.userId === loggedUserId) {
        msgDiv.classList.add("me")
        document.getElementById('messages').classList.add('meBloque')
    } else {
        msgDiv.classList.add("other")
        document.getElementById('messages').classList.add('otherBloque')
    }

    document.getElementById('messages').appendChild(msgDiv)
  })
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

